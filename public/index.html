<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöå ÎÇ¥ Î≤ÑÏä§ - 2Í∞ú Î£®Ìä∏</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f8fafc;
        }
        .route-tab {
            transition: all 0.3s ease;
        }
        .route-tab.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function MultiBusApp() {
            const [currentTime, setCurrentTime] = useState(new Date());
            const [allRouteData, setAllRouteData] = useState([]);
            const [lastUpdated, setLastUpdated] = useState(new Date());
            const [isLoading, setIsLoading] = useState(false);
            const [selectedRoute, setSelectedRoute] = useState('all');

            // Î∞±ÏóîÎìú API Ìò∏Ï∂ú
            const fetchBusData = async (route = 'all') => {
                setIsLoading(true);
                
                try {
                    const apiUrl = `/api/bus-arrival${route !== 'all' ? `?route=${route}` : ''}`;
                    
                    console.log('=== Îã§Ï§ë Î£®Ìä∏ API Ìò∏Ï∂ú ===');
                    console.log('URL:', apiUrl);
                    
                    const response = await fetch(apiUrl);
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('‚úÖ API ÏùëÎãµ:', result);
                        
                        if (result.success && result.data) {
                            setAllRouteData(result.data);
                            setLastUpdated(new Date());
                            console.log('üì± Îã§Ï§ë Î£®Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏!');
                            console.log('Ï¥ù Î£®Ìä∏ Ïàò:', result.totalRoutes);
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    console.log('‚ùå API Ìò∏Ï∂ú Ïã§Ìå®:', error.message);
                    
                    // Í∞ÄÏÉÅ Îç∞Ïù¥ÌÑ∞Î°ú ÎåÄÏ≤¥
                    const mockRoutes = [
                        {
                            routeKey: 'route1',
                            routeName: '52Î≤à + 52-1Î≤à',
                            stationId: '226000012',
                            stationName: 'Í∏ÄÎ°úÎ≤åÎèÑÏÑúÍ¥Ä,ÏÑ±ÏõêÏïÑÌååÌä∏',
                            buses: [
                                {
                                    routeName: '52',
                                    routeDestName: 'Ï∞ΩÎ∞ïÍ≥®',
                                    predictTime1: Math.floor(Math.random() * 15) + 3,
                                    predictTime2: Math.floor(Math.random() * 25) + 18,
                                    locationNo1: Math.floor(Math.random() * 10) + 2,
                                    locationNo2: Math.floor(Math.random() * 15) + 8,
                                    lowPlate1: '1',
                                    lowPlate2: '1',
                                    plateNo1: 'Í≤ΩÍ∏∞71Î∞î' + Math.floor(Math.random() * 9999),
                                    plateNo2: 'Í≤ΩÍ∏∞71Î∞î' + Math.floor(Math.random() * 9999),
                                    stationName: 'Í∏ÄÎ°úÎ≤åÎèÑÏÑúÍ¥Ä,ÏÑ±ÏõêÏïÑÌååÌä∏'
                                },
                                {
                                    routeName: '52-1',
                                    routeDestName: 'ÎçîÏÉµÏÑºÌä∏Îü¥ÏãúÌã∞Ï†ïÎ¨∏',
                                    predictTime1: Math.floor(Math.random() * 20) + 5,
                                    predictTime2: 0,
                                    locationNo1: Math.floor(Math.random() * 12) + 3,
                                    locationNo2: 0,
                                    lowPlate1: '0',
                                    lowPlate2: '0',
                                    plateNo1: 'Í≤ΩÍ∏∞71Î∞î' + Math.floor(Math.random() * 9999),
                                    plateNo2: '',
                                    stationName: 'Í∏ÄÎ°úÎ≤åÎèÑÏÑúÍ¥Ä,ÏÑ±ÏõêÏïÑÌååÌä∏'
                                }
                            ]
                        },
                        {
                            routeKey: 'route2',
                            routeName: '441Î≤à + 502Î≤à + 22Î≤à + 51Î≤à',
                            buses: [
                                {
                                    routeName: '441',
                                    routeDestName: 'Ïã†ÏÇ¨Ïó≠1Î≤àÏ∂úÍµ¨',
                                    predictTime1: Math.floor(Math.random() * 12) + 2,
                                    predictTime2: Math.floor(Math.random() * 18) + 10,
                                    locationNo1: Math.floor(Math.random() * 8) + 1,
                                    locationNo2: Math.floor(Math.random() * 12) + 5,
                                    lowPlate1: '1',
                                    lowPlate2: '1',
                                    plateNo1: 'ÏÑúÏö∏70ÏÇ¨' + Math.floor(Math.random() * 9999),
                                    plateNo2: 'ÏÑúÏö∏74ÏÇ¨' + Math.floor(Math.random() * 9999),
                                    stationName: 'Ï†ïÎ•òÏû•2'
                                },
                                {
                                    routeName: '502',
                                    routeDestName: 'ÌïúÍµ≠ÏùÄÌñâ.Ïã†ÏÑ∏Í≥ÑÏïû',
                                    predictTime1: Math.floor(Math.random() * 10) + 4,
                                    predictTime2: Math.floor(Math.random() * 15) + 12,
                                    locationNo1: Math.floor(Math.random() * 6) + 2,
                                    locationNo2: Math.floor(Math.random() * 10) + 8,
                                    lowPlate1: '1',
                                    lowPlate2: '1',
                                    plateNo1: 'ÏÑúÏö∏70ÏÇ¨' + Math.floor(Math.random() * 9999),
                                    plateNo2: 'ÏÑúÏö∏70ÏÇ¨' + Math.floor(Math.random() * 9999),
                                    stationName: 'Ï†ïÎ•òÏû•2'
                                },
                                {
                                    routeName: '22',
                                    routeDestName: 'ÎçïÏû•Ï¥àÍµê',
                                    predictTime1: Math.floor(Math.random() * 15) + 3,
                                    predictTime2: Math.floor(Math.random() * 25) + 15,
                                    locationNo1: Math.floor(Math.random() * 8) + 2,
                                    locationNo2: Math.floor(Math.random() * 12) + 8,
                                    lowPlate1: '0',
                                    lowPlate2: '0',
                                    plateNo1: 'Í≤ΩÍ∏∞71Î∞î' + Math.floor(Math.random() * 9999),
                                    plateNo2: 'Í≤ΩÍ∏∞71Î∞î' + Math.floor(Math.random() * 9999),
                                    stationName: '22Î≤à Ï†ïÎ•òÏû•'
                                },
                                {
                                    routeName: '51',
                                    routeDestName: 'ÌèâÏ¥åÏ∞®Í≥†ÏßÄ',
                                    predictTime1: Math.floor(Math.random() * 12) + 4,
                                    predictTime2: Math.floor(Math.random() * 18) + 12,
                                    locationNo1: Math.floor(Math.random() * 6) + 1,
                                    locationNo2: Math.floor(Math.random() * 10) + 6,
                                    lowPlate1: '0',
                                    lowPlate2: '0',
                                    plateNo1: 'Í≤ΩÍ∏∞71Î∞î' + Math.floor(Math.random() * 9999),
                                    plateNo2: 'Í≤ΩÍ∏∞71Î∞î' + Math.floor(Math.random() * 9999),
                                    stationName: '51Î≤à Ï†ïÎ•òÏû•'
                                }
                            ]
                        },
                        {
                            routeKey: 'route3',
                            routeName: '10Î≤à',
                            stationId: '226000046',
                            stationName: 'Ï†ïÎ•òÏû•2',
                            buses: [
                                {
                                    routeName: '10',
                                    routeDestName: 'Ï∞ΩÎ∞ïÍ≥®',
                                    predictTime1: Math.floor(Math.random() * 12) + 2,
                                    predictTime2: Math.floor(Math.random() * 20) + 8,
                                    locationNo1: Math.floor(Math.random() * 6) + 2,
                                    locationNo2: Math.floor(Math.random() * 10) + 5,
                                    lowPlate1: '1',
                                    lowPlate2: '1',
                                    plateNo1: 'Í≤ΩÍ∏∞71Î∞î' + Math.floor(Math.random() * 9999),
                                    plateNo2: 'Í≤ΩÍ∏∞71Î∞î' + Math.floor(Math.random() * 9999),
                                    stationName: 'Ï†ïÎ•òÏû•2'
                                }
                            ]
                        }
                    ];
                    
                    setAllRouteData(mockRoutes);
                    setLastUpdated(new Date());
                }
                
                setIsLoading(false);
            };

            // ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            // ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®
            useEffect(() => {
                fetchBusData(selectedRoute);
                const interval = setInterval(() => fetchBusData(selectedRoute), 30000);
                return () => clearInterval(interval);
            }, [selectedRoute]);

            const formatTime = (date) => {
                return date.toLocaleTimeString('ko-KR', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
            };

            const getArrivalStatus = (minutes) => {
                if (!minutes || minutes === '' || minutes === 0) return { text: 'Ï†ïÎ≥¥ÏóÜÏùå', color: 'text-gray-400' };
                if (minutes <= 2) return { text: `${minutes}Î∂Ñ ÌõÑ`, color: 'text-red-600 font-bold animate-pulse' };
                if (minutes <= 5) return { text: `${minutes}Î∂Ñ`, color: 'text-orange-600 font-bold' };
                if (minutes <= 10) return { text: `${minutes}Î∂Ñ`, color: 'text-yellow-600' };
                return { text: `${minutes}Î∂Ñ`, color: 'text-gray-600' };
            };

            const getRouteColor = (routeKey) => {
                const colors = {
                    'route1': 'from-blue-500 to-blue-600',
                    'route2': 'from-green-500 to-green-600'
                };
                return colors[routeKey] || 'from-gray-500 to-gray-600';
            };

            // ÌïÑÌÑ∞Îêú Î£®Ìä∏ Îç∞Ïù¥ÌÑ∞
            const filteredRoutes = selectedRoute === 'all' ? allRouteData : 
                                 allRouteData.filter(route => route.routeKey === selectedRoute);

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen shadow-lg">
                    {/* Ìó§Îçî */}
                    <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4">
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-xl font-bold">üöå ÎÇ¥ Î≤ÑÏä§ (3Í∞ú Î£®Ìä∏)</h1>
                                <p className="text-sm opacity-90">
                                    üïê {formatTime(currentTime)}
                                </p>
                                <p className="text-xs opacity-75">
                                    üìç Îã§Ï§ë Ï†ïÎ•òÏû• ÌÜµÌï© Ï†ïÎ≥¥
                                </p>
                            </div>
                            <button
                                onClick={() => fetchBusData(selectedRoute)}
                                disabled={isLoading}
                                className="bg-white/20 p-3 rounded-full hover:bg-white/30 transition-colors"
                            >
                                <span className={`inline-block text-lg ${isLoading ? 'animate-spin' : ''}`}>üîÑ</span>
                            </button>
                        </div>
                    </div>

                    {/* Î£®Ìä∏ ÌÉ≠ */}
                    <div className="bg-gray-100 p-2 flex space-x-2">
                        <button
                            onClick={() => setSelectedRoute('all')}
                            className={`route-tab flex-1 py-2 px-3 rounded-lg text-sm font-medium ${
                                selectedRoute === 'all' ? 'active' : 'bg-white text-gray-600 hover:bg-gray-50'
                            }`}
                        >
                            Ï†ÑÏ≤¥
                        </button>
                        <button
                            onClick={() => setSelectedRoute('route1')}
                            className={`route-tab flex-1 py-2 px-3 rounded-lg text-sm font-medium ${
                                selectedRoute === 'route1' ? 'active' : 'bg-white text-gray-600 hover:bg-gray-50'
                            }`}
                        >
                            52Î≤à ÎùºÏù∏
                        </button>
                        <button
                            onClick={() => setSelectedRoute('route2')}
                            className={`route-tab flex-1 py-2 px-3 rounded-lg text-sm font-medium ${
                                selectedRoute === 'route2' ? 'active' : 'bg-white text-gray-600 hover:bg-gray-50'
                            }`}
                        >
                            441 ÎùºÏù∏+
                        </button>
                        <button
                            onClick={() => setSelectedRoute('route3')}
                            className={`route-tab flex-1 py-2 px-3 rounded-lg text-sm font-medium ${
                                selectedRoute === 'route3' ? 'active' : 'bg-white text-gray-600 hover:bg-gray-50'
                            }`}
                        >
                            10Î≤à ÎùºÏù∏
                        </button>
                    </div>

                    {/* ÏÉÅÌÉú ÌëúÏãú */}
                    <div className="px-4 py-2 bg-gray-50 border-b text-xs text-gray-600 text-center">
                        ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: {formatTime(lastUpdated)} ¬∑ 30Ï¥àÎßàÎã§ ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®
                    </div>

                    {/* Î£®Ìä∏Î≥Ñ Î≤ÑÏä§ Ï†ïÎ≥¥ */}
                    <div className="p-4 space-y-4">
                        {filteredRoutes.length === 0 ? (
                            <div className="text-center py-8 text-gray-500">
                                <div className="text-4xl mb-2">üöå</div>
                                <p>Î≤ÑÏä§ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                            </div>
                        ) : (
                            filteredRoutes.map((route, routeIndex) => (
                                <div key={route.routeKey} className="space-y-3">
                                    {/* Î£®Ìä∏ Ìó§Îçî */}
                                    <div className={`bg-gradient-to-r ${getRouteColor(route.routeKey)} text-white p-3 rounded-t-lg`}>
                                        <h3 className="font-bold text-sm">{route.routeName}</h3>
                                        <p className="text-xs opacity-90">
                                            üìç {route.stationName} ({route.stationId})
                                        </p>
                                    </div>

                                    {/* Î≤ÑÏä§Î≥Ñ Ï†ïÎ≥¥ */}
                                    <div className="bg-white rounded-b-lg border border-t-0 p-3 space-y-4">
                                        {route.buses.map((bus, busIndex) => (
                                            <div key={`${route.routeKey}-${busIndex}`} className="border-l-4 border-blue-200 pl-3">
                                                {/* Î≤ÑÏä§ Î≤àÌò∏ÏôÄ Î™©Ï†ÅÏßÄ */}
                                                <div className="flex items-center justify-between mb-3">
                                                    <div className="flex items-center space-x-3">
                                                        <div className="bg-blue-500 text-white px-3 py-1 rounded-full font-bold text-sm">
                                                            {bus.routeName}Î≤à
                                                        </div>
                                                        <div className="text-sm text-gray-600">
                                                            ‚Üí {bus.routeDestName}
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* ÎèÑÏ∞© ÏãúÍ∞ÑÎì§ */}
                                                <div className="grid grid-cols-2 gap-3">
                                                    {/* Ï≤´ Î≤àÏß∏ Î≤ÑÏä§ */}
                                                    <div className="text-center p-3 bg-gray-50 rounded-lg">
                                                        <div className="text-xs text-gray-500 mb-1">Îã§ÏùåÏ∞®</div>
                                                        <div className={`text-xl font-bold ${getArrivalStatus(bus.predictTime1).color}`}>
                                                            {getArrivalStatus(bus.predictTime1).text}
                                                        </div>
                                                        {bus.locationNo1 && bus.locationNo1 > 0 && (
                                                            <div className="text-xs text-gray-400 mt-1">
                                                                {bus.locationNo1}Ï†ïÍ±∞Ïû• Ï†Ñ
                                                            </div>
                                                        )}
                                                        {bus.plateNo1 && (
                                                            <div className="text-xs text-gray-500 mt-1">
                                                                {bus.plateNo1}
                                                            </div>
                                                        )}
                                                        {(bus.lowPlate1 === 1 || bus.lowPlate1 === '1') && (
                                                            <div className="text-xs text-blue-600 mt-1">‚ôø Ï†ÄÏÉÅ</div>
                                                        )}
                                                    </div>

                                                    {/* Îëê Î≤àÏß∏ Î≤ÑÏä§ */}
                                                    <div className="text-center p-3 bg-gray-50 rounded-lg">
                                                        <div className="text-xs text-gray-500 mb-1">Í∑∏Îã§ÏùåÏ∞®</div>
                                                        <div className={`text-xl font-bold ${getArrivalStatus(bus.predictTime2).color}`}>
                                                            {getArrivalStatus(bus.predictTime2).text}
                                                        </div>
                                                        {bus.locationNo2 && bus.locationNo2 > 0 && (
                                                            <div className="text-xs text-gray-400 mt-1">
                                                                {bus.locationNo2}Ï†ïÍ±∞Ïû• Ï†Ñ
                                                            </div>
                                                        )}
                                                        {bus.plateNo2 && (
                                                            <div className="text-xs text-gray-500 mt-1">
                                                                {bus.plateNo2}
                                                            </div>
                                                        )}
                                                        {(bus.lowPlate2 === 1 || bus.lowPlate2 === '1') && (
                                                            <div className="text-xs text-blue-600 mt-1">‚ôø Ï†ÄÏÉÅ</div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))
                        )}
                    </div>

                    {/* ÌïòÎã® Ï†ïÎ≥¥ */}
                    <div className="p-4 bg-gray-50 text-xs text-gray-600 text-center space-y-2">
                        <div className="bg-green-50 border border-green-200 rounded p-3">
                            <div className="font-semibold text-green-800 mb-1">üéâ Îã§Ï§ë Î£®Ìä∏ ÌÜµÌï© Ïï±!</div>
                            <div className="text-green-700 text-left space-y-1">
                                <div>‚úÖ Î£®Ìä∏ 1: 52Î≤à, 52-1Î≤à</div>
                                <div>‚úÖ Î£®Ìä∏ 2: 441Î≤à, 502Î≤à, 22Î≤à, 51Î≤à</div>
                                <div>‚úÖ Î£®Ìä∏ 3: 10Î≤à</div>
                                <div>‚úÖ Îã§Ï§ë Ï†ïÎ•òÏû• ÏßÄÏõê</div>
                                <div>‚úÖ Ïã§ÏãúÍ∞Ñ Í≤ΩÍ∏∞ÎèÑ API Ïó∞Îèô</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<MultiBusApp />, document.getElementById('root'));
    </script>
</body>
</html>
